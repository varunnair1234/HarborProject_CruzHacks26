<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harbor - Small Business Operating System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #EFE7DB;
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Floating color orbs */
        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            animation: float 20s ease-in-out infinite;
        }

        body::before {
            width: 300px;
            height: 300px;
            background: rgba(10, 79, 110, 0.15);
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        body::after {
            width: 200px;
            height: 200px;
            background: rgba(255, 107, 107, 0.15);
            bottom: 15%;
            right: 10%;
            animation-delay: 5s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 2.5rem;
            color: #0A4D68;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* Brutalist Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 3rem;
            padding: 0;
            background: transparent;
            flex-wrap: wrap;
            position: relative;
            z-index: 10;
        }

        .tab-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            background: #e8d5b7;
            border: 3px solid #0a4f6e;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 700;
            color: #0a4f6e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 6px 6px 0 0 rgba(10, 79, 110, 0.3);
            transform: rotate(-1deg);
            position: relative;
        }

        .tab-button:nth-child(2) {
            transform: rotate(0.5deg);
        }

        .tab-button:nth-child(3) {
            transform: rotate(-0.5deg);
        }

        .tab-button:nth-child(4) {
            transform: rotate(1deg);
        }

        .tab-button:nth-child(5) {
            transform: rotate(-0.75deg);
        }

        .tab-button:hover {
            transform: rotate(0deg) translateY(-2px);
            box-shadow: 8px 8px 0 0 rgba(10, 79, 110, 0.4);
            background: white;
        }

        .tab-button.active {
            background: #0a4f6e;
            color: #e8d5b7;
            border-color: #0a4f6e;
            transform: rotate(0deg);
            box-shadow: 8px 8px 0 0 rgba(255, 107, 107, 0.5);
        }

        .tab-button.active:hover {
            transform: translateY(-2px);
            box-shadow: 10px 10px 0 0 rgba(255, 107, 107, 0.6);
        }

        .tab-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .tab-icon svg {
            width: 100%;
            height: 100%;
            stroke: currentColor;
        }


        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Common Styles */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #0a4f6e;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        .error {
            background: white;
            border: 3px solid #ff6b6b;
            border-radius: 0;
            padding: 1.5rem;
            color: #ff6b6b;
            margin: 2rem 0;
            box-shadow: 6px 6px 0 0 rgba(255, 107, 107, 0.3);
            transform: rotate(-0.5deg);
            font-weight: 600;
        }

        .error code {
            background: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            display: block;
            margin-top: 0.5rem;
        }

        .success-message {
            background: #dcfce7;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 1.5rem;
            color: #166534;
            margin: 1rem 0;
        }

        /* TouristPulse Styles */
        .outlook-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .outlook-card {
            background: #fef7f0;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #f5e6d3;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .outlook-card.moderate {
            background: #e0f2fe;
            border: 1px solid #bae6fd;
        }

        .outlook-card.low {
            background: #fef9e7;
            border: 1px solid #fef3c7;
        }

        .outlook-card.high {
            background: #fff1f2;
            border: 1px solid #fecdd3;
        }

        .outlook-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-date-container {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .card-day {
            font-size: 0.875rem;
            font-weight: 500;
            color: #9ca3af;
        }

        .card-date {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .activity-badge-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .activity-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .activity-badge.high {
            background: #fed7aa;
            color: #9a3412;
        }

        .activity-badge.moderate {
            background: #dbeafe;
            color: #1e40af;
        }

        .activity-badge.low {
            background: #fef3c7;
            color: #92400e;
        }

        .activity-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .activity-icon svg {
            width: 100%;
            height: 100%;
        }

        .activity-progress-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activity-progress-bar {
            width: 60px;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }

        .activity-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4b5563, #6b7280);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .activity-percentage {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }

        .card-summary {
            margin: 1rem 0;
            line-height: 1.6;
            color: #4b5563;
            font-size: 0.95rem;
            font-style: italic;
            padding: 0 0.5rem;
        }

        .card-summary::before {
            content: '"';
        }

        .card-summary::after {
            content: '"';
        }

        .key-drivers {
            margin-top: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .key-drivers-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .driver-item {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
        }

        .driver-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: #86efac;
        }

        .driver-icon svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        /* Module Container Styles */
        .module-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .module-container {
                grid-template-columns: 1fr;
            }
        }

        .form-panel, .results-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        .form-panel h3, .results-panel h3 {
            color: #0A4D68;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0A4D68;
        }

        .form-group small {
            display: block;
            margin-top: 0.25rem;
            color: #6b7280;
            font-size: 0.85rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-divider {
            text-align: center;
            margin: 1rem 0;
            color: #9ca3af;
            font-weight: 600;
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #0A4D68;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #083d54;
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        /* File Input Styling */
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            background: #f9fafb;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 120px;
        }

        .file-input-label:hover {
            border-color: #9ca3af;
            background: #f3f4f6;
        }

        .file-input-label.has-file {
            border-color: #22c55e;
            background: #dcfce7;
            color: #166534;
        }

        /* Results Panel Empty State */
        .results-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }

        .results-empty svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Risk State Badges */
        .risk-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-badge.healthy {
            background: #dcfce7;
            color: #166534;
        }

        .risk-badge.caution {
            background: #fef3c7;
            color: #92400e;
        }

        .risk-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Impact Card */
        .impact-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .impact-header {
            background: linear-gradient(135deg, #0A4D68, #0e6b8a);
            color: white;
            padding: 1rem 1.5rem;
        }

        .impact-header h4 {
            margin: 0;
            font-size: 1.1rem;
        }

        .impact-body {
            padding: 1.5rem;
        }

        .impact-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 600px) {
            .impact-metrics {
                grid-template-columns: 1fr;
            }
        }

        .metric-item {
            text-align: center;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0A4D68;
        }

        .metric-value.negative {
            color: #dc2626;
        }

        .metric-value.positive {
            color: #16a34a;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .risk-transition {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .risk-arrow {
            font-size: 1.5rem;
            color: #6b7280;
        }

        /* Explanation Section */
        .explanation-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        .explanation-section h5 {
            color: #374151;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .explanation-section p {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .concerns-list,
        .recommendations-list,
        .bullets-list {
            margin: 0;
            padding-left: 1.25rem;
        }

        .concerns-list li {
            color: #dc2626;
            margin-bottom: 0.5rem;
        }

        .recommendations-list li {
            color: #0A4D68;
            margin-bottom: 0.5rem;
        }

        .bullets-list li {
            color: #374151;
            margin-bottom: 0.5rem;
        }

        /* Scenarios/History List */
        .history-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        .history-section-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .history-icon {
            width: 1.25rem;
            height: 1.25rem;
            color: #6b7280;
        }

        .history-section-header h4 {
            color: #374151;
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .analysis-history-card {
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .analysis-history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .critical-card {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }

        .caution-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .healthy-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }

        .analysis-history-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .analysis-history-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .analysis-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .analysis-info {
            flex: 1;
        }

        .analysis-business-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .analysis-date {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .analysis-status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.875rem;
            border-radius: 8px;
            border: 1px solid;
            font-size: 0.875rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-icon {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;
        }

        /* Warning Message */
        .warning-message {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            color: #92400e;
        }

        .warning-message a {
            color: #0A4D68;
            font-weight: 600;
        }

        /* Shopline Styles */
        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-box input {
            flex: 1;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: #0A4D68;
        }

        .search-box button {
            padding: 0.875rem 1.5rem;
            background: #0A4D68;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .search-box button:hover {
            background: #083d54;
        }

        /* Shopline Hero Section */
        .shopline-hero {
            margin-bottom: 4rem;
            position: relative;
        }

        .hero-header {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
            align-items: start;
        }

        .hero-title-section h1 {
            font-size: 6rem;
            font-weight: 700;
            color: #0a4f6e;
            line-height: 0.9;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: -2px;
            transform: rotate(-1deg);
        }

        .hero-tagline {
            font-size: 1.25rem;
            color: #0a4f6e;
            font-weight: 500;
            margin-bottom: 1.5rem;
            max-width: 600px;
        }

        .hero-location-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            background: #e8d5b7;
            border: 3px solid #0a4f6e;
            border-radius: 50px;
            font-weight: 600;
            color: #0a4f6e;
            transform: rotate(-2deg);
            box-shadow: 4px 4px 0 0 rgba(10, 79, 110, 0.3);
        }

        .hero-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #ff6b6b;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .hero-stats {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat-card {
            background: white;
            border: 3px solid #0a4f6e;
            padding: 1.5rem;
            box-shadow: 6px 6px 0 0 rgba(10, 79, 110, 0.3);
            transform: rotate(1deg);
            transition: all 0.3s;
        }

        .stat-card:nth-child(2) {
            transform: rotate(-1deg);
            border-color: #2d5f3f;
            box-shadow: 6px 6px 0 0 rgba(45, 95, 63, 0.3);
        }

        .stat-card:hover {
            transform: rotate(0deg) translateY(-4px);
            box-shadow: 8px 8px 0 0 rgba(10, 79, 110, 0.4);
        }

        .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #0a4f6e;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0a4f6e;
            line-height: 1;
        }

        /* Brutalist Search Box */
        .search-box {
            margin-bottom: 3rem;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 1.25rem 1.5rem;
            background: white;
            border: 3px solid #0a4f6e;
            font-size: 1rem;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 500;
            color: #0a4f6e;
            box-shadow: 8px 8px 0 0 rgba(10, 79, 110, 0.3);
            transform: rotate(-0.5deg);
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            transform: rotate(0deg);
            box-shadow: 10px 10px 0 0 rgba(10, 79, 110, 0.4);
        }

        .search-box input::placeholder {
            color: #9ca3af;
        }

        .search-button {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            padding: 0.75rem 1.5rem;
            background: #0a4f6e;
            color: white;
            border: 3px solid #0a4f6e;
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 4px 4px 0 0 rgba(255, 107, 107, 0.5);
            transition: all 0.3s;
            overflow: hidden;
        }

        .search-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .search-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .search-button:hover {
            box-shadow: 6px 6px 0 0 rgba(255, 107, 107, 0.6);
        }

        /* Clean Business Grid */
        .business-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .business-card {
            background: white;
            border: 1px solid #0a4f6e;
            padding: 1.5rem;
            transition: all 0.2s;
            position: relative;
            border-radius: 0;
        }

        .business-card:hover {
            box-shadow: 0 4px 12px rgba(10, 79, 110, 0.15);
        }

        .business-card h4 {
            color: #0a4f6e;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-top: 0.5rem;
        }

        .business-card .category {
            display: inline-block;
            background: #0a4f6e;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }

        .business-card .location {
            color: #0a4f6e;
            font-size: 0.9rem;
            font-weight: 400;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .business-card .location svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .business-card .description {
            color: #0a4f6e;
            font-size: 0.9rem;
            line-height: 1.5;
            font-weight: 400;
        }

        .business-card .score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .score-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #2d5f3f, #0a4f6e);
        }

        .score-value {
            font-weight: 600;
            color: #0A4D68;
        }

        /* Why Local Card */
        .why-local-card {
            background: #F9F7F4;
            border: 2px solid #2d5f3f;
            border-radius: 8px 8px 0 0;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .why-local-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d5f3f;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .why-local-text {
            font-size: 1rem;
            color: #374151;
            line-height: 1.6;
            margin: 0;
        }

        .highlights-list {
            margin-top: 0.75rem;
            padding-left: 1rem;
        }

        .highlights-list li {
            color: #16a34a;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-header h2 {
            margin: 0;
        }

        .forecast-header {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .forecast-title {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 2rem;
            font-weight: 400;
            color: #374151;
            margin: 0;
            line-height: 1.2;
        }

        .forecast-location {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            margin-left: 0.5rem;
            font-size: 0.95rem;
            color: #9ca3af;
            font-weight: 400;
        }

        /* CashFlow Calm Header Card */
        .cashflow-header-card {
            background: linear-gradient(135deg, #e8f0f5 0%, #f5f8fa 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .cashflow-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 2rem;
        }

        .cashflow-header-left {
            flex: 1;
        }

        .cashflow-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #b2e5e8;
            color: #0d7377;
            padding: 0.375rem 0.875rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .cashflow-tag-icon {
            width: 1rem;
            height: 1rem;
        }

        .cashflow-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 0.75rem 0;
            line-height: 1.2;
        }

        .cashflow-description {
            font-size: 1rem;
            color: #6b7280;
            margin: 0;
            line-height: 1.6;
            max-width: 600px;
        }

        .cashflow-header-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .cashflow-feature-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .cashflow-feature-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
            transform: translateY(-1px);
        }

        .cashflow-btn-icon {
            width: 1.125rem;
            height: 1.125rem;
            color: #14b8a6;
        }

        /* Section Title Headers */
        .section-title-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .section-title-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section-title-icon svg {
            width: 1.75rem;
            height: 1.75rem;
        }

        .upload-icon {
            background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%);
        }

        .results-icon {
            background: #3b82f6;
        }

        .section-title-content {
            flex: 1;
        }

        .section-title-main {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 0.25rem 0;
            line-height: 1.2;
        }

        .section-title-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
            line-height: 1.4;
        }

        /* Form Inputs with Icons */
        .form-label-with-icon {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-label-icon {
            width: 1.125rem;
            height: 1.125rem;
            color: #14b8a6;
            flex-shrink: 0;
        }

        .required-asterisk {
            color: #ef4444;
            margin-left: 0.125rem;
        }

        .form-label-hint {
            font-size: 0.75rem;
            font-weight: 400;
            color: #6b7280;
            margin-left: auto;
        }

        .form-input-with-icon {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input-with-icon:focus {
            outline: none;
            border-color: #14b8a6;
        }

        /* Analyze Cash Flow Button */
        .btn-analyze-cashflow {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            background: #14b8a6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
        }

        .btn-analyze-cashflow:hover {
            background: #0d9488;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .btn-analyze-cashflow:active {
            transform: translateY(0);
        }

        .btn-icon-left,
        .btn-icon-right {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
        }

        .location-icon {
            width: 16px;
            height: 16px;
            color: #9ca3af;
            flex-shrink: 0;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: #f5f5f4;
            border: 1px solid #d4d4d4;
            border-radius: 9999px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: #e7e5e4;
            border-color: #a3a3a3;
        }

        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .refresh-icon {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;
        }

        /* Analysis Display Card */
        .analysis-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .analysis-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .analysis-card-header h4 {
            color: #0A4D68;
            margin: 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        /* Auth Styles */
        .auth-container {
            max-width: 500px;
            margin: 3rem auto;
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .auth-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: #0A4D68;
            border-bottom-color: #0A4D68;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form-group {
            margin-bottom: 1.25rem;
        }

        .auth-form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .auth-form-group input,
        .auth-form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .auth-form-group input:focus,
        .auth-form-group select:focus {
            outline: none;
            border-color: #0A4D68;
        }

        .auth-error {
            background: #fee2e2;
            color: #991b1b;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .auth-success {
            background: #d1fae5;
            color: #065f46;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .logout-btn {
            position: absolute;
            right: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            background: #991b1b;
            color: white;
            border: 1px solid #dc2626;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #7f1d1d;
            border-color: #b91c1c;
        }

        .logout-btn svg {
            width: 1rem;
            height: 1rem;
        }

        /* Profile Styles */
        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .profile-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0A4D68, #088395);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .profile-icon svg {
            width: 32px;
            height: 32px;
        }

        .profile-header h3 {
            margin: 0;
            color: #0A4D68;
            font-size: 1.5rem;
        }

        .profile-details {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .profile-detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .profile-label {
            font-weight: 600;
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-value {
            color: #1f2937;
            font-size: 1.1rem;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .profile-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 600px;
        }

        .profile-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Harbor</h1>
        <p class="subtitle">The operating system for small businesses in Santa Cruz</p>

        <!-- Auth Container (shown when not logged in) -->
        <div id="auth-container" class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthForm('login')">Login</button>
                <button class="auth-tab" onclick="showAuthForm('signup')">Sign Up</button>
            </div>

            <div id="auth-error" class="auth-error"></div>
            <div id="auth-success" class="auth-success"></div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form active" onsubmit="handleLogin(event); return false;">
                <div class="auth-form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="auth-form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-primary" id="login-btn">Login</button>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="auth-form" onsubmit="handleSignup(event)">
                <div class="auth-form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="auth-form-group">
                    <label for="signup-business-name">Business Name</label>
                    <input type="text" id="signup-business-name" required>
                </div>
                <div class="auth-form-group">
                    <label for="signup-address">Address</label>
                    <input type="text" id="signup-address" required>
                </div>
                <div class="auth-form-group">
                    <label for="signup-business-type">Business Type</label>
                    <select id="signup-business-type" required>
                        <option value="">Select a type</option>
                        <option value="cafe">Cafe</option>
                        <option value="boutique">Boutique</option>
                        <option value="bakery/dessert">Bakery/Dessert</option>
                        <option value="bookstore/stationary">Bookstore/Stationary</option>
                        <option value="art">Art</option>
                    </select>
                </div>
                <div class="auth-form-group">
                    <label for="signup-password">Password (min 8 characters)</label>
                    <input type="password" id="signup-password" minlength="8" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
            </form>
        </div>

        <!-- Main App (shown when logged in) -->
        <div id="main-app" style="display: none;">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" data-tab="shopline">
                    <span class="tab-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                        </svg>
                    </span>
                    Shopline
                </button>
                <button class="tab-button" data-tab="touristpulse" style="display: none;">
                    <span class="tab-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                        </svg>
                    </span>
                    TouristPulse
                </button>
                <button class="tab-button" data-tab="cashflow" style="display: none;">
                    <span class="tab-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13l4-4 4 4 6-6M3 21V9a2 2 0 012-2h14a2 2 0 012 2v12" />
                        </svg>
                    </span>
                    CashFlow
                </button>
                <button class="tab-button" data-tab="rentguard" style="display: none;">
                    <span class="tab-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                        </svg>
                    </span>
                    RentGuard
                </button>
                <button class="tab-button" data-tab="profile" style="display: none;">
                    <span class="tab-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    </span>
                    Profile
                </button>
            </div>

        <!-- TouristPulse Tab -->
        <div id="touristpulse" class="tab-content">
            <div class="cashflow-header-card">
                <div class="cashflow-header-content">
                    <div class="cashflow-header-left">
                        <div class="cashflow-tag">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-tag-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                            </svg>
                            <span>Tourism Intelligence</span>
                        </div>
                        <h2 class="cashflow-title">TouristPulse</h2>
                        <p class="cashflow-description">Get AI-powered 7-day tourism forecasts for Santa Cruz to plan your business operations and staffing.</p>
                    </div>
                    <div class="cashflow-header-buttons">
                        <button class="cashflow-feature-btn" onclick="loadTouristOutlook()" id="refresh-tourist-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.25 16.5h7.5m-7.5 0h-5.25m5.25 0v-1.125c0-1.645.933-3.063 2.25-3.75m0 0c.866-.5 1.875-.75 2.875-.75h3.75m-3.75 0a9 9 0 01-2.25-3.75m0 0c.866-.5 1.875-.75 2.875-.75h3.75m-3.75 0a9 9 0 00-2.25 3.75m0 0h-4.992v.001M21.75 7.5h-4.992v-.001" />
                            </svg>
                            <span>7-Day Forecast</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
                            </svg>
                            <span>Weather Analysis</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                            </svg>
                            <span>Event Insights</span>
                        </button>
                    </div>
                </div>
            </div>
            <div id="tourist-loading" class="loading">Loading tourism predictions</div>
            <div id="tourist-error" class="error" style="display: none;"></div>
            <div id="tourist-outlook" class="outlook-grid" style="display: none;"></div>
        </div>

        <!-- CashFlow Calm Tab -->
        <div id="cashflow" class="tab-content">
            <div class="cashflow-header-card">
                <div class="cashflow-header-content">
                    <div class="cashflow-header-left">
                        <div class="cashflow-tag">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-tag-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                            </svg>
                            <span>Financial Early Warning</span>
                        </div>
                        <h2 class="cashflow-title">CashFlow Calm</h2>
                        <p class="cashflow-description">Stay ahead of cash flow problems with AI-powered analysis and runway projections for your business.</p>
                    </div>
                    <div class="cashflow-header-buttons">
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span>Runway Projections</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                            </svg>
                            <span>Risk Detection</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                            </svg>
                            <span>AI Insights</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="module-container">
                <!-- Left: Form -->
                <div class="form-panel">
                    <div class="section-title-header">
                        <div class="section-title-icon upload-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="white">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                        </div>
                        <div class="section-title-content">
                            <h3 class="section-title-main">Upload POS Data</h3>
                            <p class="section-title-subtitle">Import your sales data for analysis</p>
                        </div>
                    </div>

                    <form id="cashflow-form">
                        <div class="form-group">
                            <label for="csv-file" class="form-label-with-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                </svg>
                                POS CSV File
                            </label>
                            <div class="file-input-wrapper">
                                <input type="file" id="csv-file" accept=".csv" required>
                                <div class="file-input-label" id="file-label">
                                    <span>Click or drag to upload CSV</span>
                                </div>
                            </div>
                            <small>CSV with date and amount columns</small>
                        </div>

                        <div class="form-group">
                            <label for="business-name" class="form-label-with-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                                </svg>
                                Business Name (Optional)
                            </label>
                            <input type="text" id="business-name" placeholder="e.g., Cafe Luna" class="form-input-with-icon">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="monthly-rent" class="form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-3h6" />
                                    </svg>
                                    Monthly Rent <span class="required-asterisk">*</span>
                                </label>
                                <input type="number" id="monthly-rent" placeholder="e.g., 4500" step="1" min="1" required class="form-input-with-icon">
                            </div>
                            <div class="form-group">
                                <label for="monthly-payroll" class="form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3" />
                                    </svg>
                                    Monthly Payroll
                                </label>
                                <input type="number" id="monthly-payroll" placeholder="e.g., 8000" step="1" min="0" value="0" class="form-input-with-icon">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="other-costs" class="form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                    </svg>
                                    Other Fixed Costs
                                </label>
                                <input type="number" id="other-costs" placeholder="e.g., 1500" step="1" min="0" value="0" class="form-input-with-icon">
                            </div>
                            <div class="form-group">
                                <label for="cash-on-hand" class="form-label-with-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3" />
                                    </svg>
                                    Cash on Hand
                                </label>
                                <input type="number" id="cash-on-hand" placeholder="e.g., 25000" step="1" min="0" class="form-input-with-icon">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="variable-cost-rate" class="form-label-with-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="form-label-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 7.5h3.75a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25H9m3.75-9H9m0 0H5.25M9 7.5v9m0-9H5.25a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25H9" />
                                </svg>
                                Variable Cost Rate
                                <span class="form-label-hint">COGS/fees as fraction (0-1)</span>
                            </label>
                            <input type="number" id="variable-cost-rate" placeholder="e.g., 0.35" step="0.01" min="0" max="1" value="0" class="form-input-with-icon">
                        </div>

                        <button type="submit" class="btn-analyze-cashflow" id="analyze-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="btn-icon-left">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                            </svg>
                            Analyze Cash Flow
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="btn-icon-right">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                            </svg>
                        </button>
                    </form>
                </div>

                <!-- Right: Results -->
                <div class="results-panel">
                    <div class="section-title-header">
                        <div class="section-title-icon results-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="white">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                            </svg>
                        </div>
                        <div class="section-title-content">
                            <h3 class="section-title-main">Analysis Results</h3>
                            <p class="section-title-subtitle">Your financial health insights</p>
                        </div>
                    </div>

                    <div id="cashflow-empty" class="results-empty">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        <p>Upload your POS data to get cash flow analysis and runway projections.</p>
                    </div>

                    <div id="cashflow-loading" class="loading" style="display: none;">Analyzing your data</div>
                    <div id="cashflow-error" class="error" style="display: none;"></div>
                    <div id="cashflow-results" style="display: none;"></div>

                    <!-- Previous Analyses -->
                    <div id="cashflow-history" class="history-section" style="display: none;">
                        <div class="history-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="history-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <h4>Previous Analyses</h4>
                        </div>
                        <div id="analyses-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RentGuard Tab -->
        <div id="rentguard" class="tab-content">
            <div class="cashflow-header-card">
                <div class="cashflow-header-content">
                    <div class="cashflow-header-left">
                        <div class="cashflow-tag">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-tag-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                            </svg>
                            <span>Rent Protection</span>
                        </div>
                        <h2 class="cashflow-title">RentGuard</h2>
                        <p class="cashflow-description">Simulate rent increase impacts on your cash flow and make informed decisions about lease negotiations.</p>
                    </div>
                    <div class="cashflow-header-buttons">
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                            </svg>
                            <span>Impact Analysis</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h5.25c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                            </svg>
                            <span>Scenario Planning</span>
                        </button>
                        <button class="cashflow-feature-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="cashflow-btn-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                            </svg>
                            <span>Risk Assessment</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="module-container">
                <!-- Left: Form -->
                <div class="form-panel">
                    <h3>Simulate Rent Increase</h3>

                    <div id="rentguard-warning" class="warning-message" style="display: none;">
                        <strong>No analyses found!</strong>
                        <p style="margin-top: 0.5rem;">You need to create a CashFlow analysis first before simulating rent impacts.</p>
                        <p style="margin-top: 0.5rem;"><a href="#" onclick="showTab('cashflow'); return false;">Go to CashFlow Calm</a></p>
                    </div>

                    <form id="rentguard-form" style="display: none;">
                        <div class="form-group">
                            <label for="analysis-select">Select Analysis</label>
                            <select id="analysis-select" required>
                                <option value="">Loading analyses...</option>
                            </select>
                            <small>Choose a CashFlow analysis to simulate rent changes</small>
                        </div>

                        <div class="form-group">
                            <label for="increase-pct">Rent Increase (%)</label>
                            <input type="number" id="increase-pct" placeholder="e.g., 15" step="0.1" min="0" max="200">
                            <small>Enter the percentage your rent will increase</small>
                        </div>

                        <div class="form-divider">- OR -</div>

                        <div class="form-group">
                            <label for="new-rent">New Monthly Rent ($)</label>
                            <input type="number" id="new-rent" placeholder="e.g., 5500" step="1" min="1">
                            <small>Enter the new absolute rent amount</small>
                        </div>

                        <div class="form-group">
                            <label for="effective-date">Effective Date (Optional)</label>
                            <input type="date" id="effective-date">
                            <small>When does the new rent take effect?</small>
                        </div>

                        <button type="submit" class="btn btn-primary" id="simulate-btn">
                            Simulate Impact
                        </button>
                    </form>
                </div>

                <!-- Right: Results -->
                <div class="results-panel">
                    <h3>Impact Analysis</h3>

                    <div id="rentguard-empty" class="results-empty">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                        <p>Select an analysis and enter a rent increase to see the impact on your business.</p>
                    </div>

                    <div id="rentguard-loading" class="loading" style="display: none;">Calculating impact</div>
                    <div id="rentguard-error" class="error" style="display: none;"></div>
                    <div id="rentguard-results" style="display: none;"></div>

                    <div id="scenarios-history" class="history-section" style="display: none;">
                        <h4>Previous Scenarios</h4>
                        <div id="scenarios-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shopline Tab -->
        <div id="shopline" class="tab-content active">
            <div class="shopline-hero">
                <div class="hero-header">
                    <div class="hero-title-section">
                        <h1>Harbor</h1>
                        <p class="hero-tagline">The operating system for small businesses navigating Santa Cruz's coastal economy</p>
                        <div>
                            <div class="hero-location-badge">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                </svg>
                                <span>Santa Cruz, CA</span>
                            </div>
                            <div class="hero-status">
                                <span class="status-dot"></span>
                                <span>Live & Active</span>
                            </div>
                        </div>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-card">
                            <div class="stat-label">Local Businesses</div>
                            <div class="stat-value" id="hero-business-count">142+</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Daily Insights</div>
                            <div class="stat-value">7-Day</div>
                        </div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="shopline-query" placeholder="Search cafes, shops, studios...">
                    <button class="search-button" onclick="handleShoplineSearch()">
                        Find
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; margin-left: 0.5rem; vertical-align: middle;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                        </svg>
                    </button>
                </div>
            </div>

            <div id="shopline-loading" class="loading">Loading businesses</div>
            <div id="shopline-error" class="error" style="display: none;"></div>

            <div id="shopline-results" style="display: none;">
                <div style="margin-bottom: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start;">
                    <div>
                        <h2 style="font-size: 2rem; font-weight: 700; color: #0a4f6e; text-transform: uppercase; letter-spacing: -1px; transform: rotate(-0.5deg);">Discover Local</h2>
                        <p style="color: #0a4f6e; font-size: 1.1rem; margin-top: 0.5rem; margin-bottom: 1rem;">Santa Cruz businesses that make our community thrive</p>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 1rem;">
                            <div class="stat-card" style="padding: 1rem 1.5rem; display: inline-block; border-color: #2d5f3f;">
                                <div class="stat-label" style="margin-bottom: 0.25rem;">Listed Businesses</div>
                                <div class="stat-value" style="font-size: 2rem;" id="business-count">142</div>
                            </div>
                        </div>
                    </div>
                    <div class="why-local-card">
                        <h3 class="why-local-title">WHY LOCAL?</h3>
                        <p class="why-local-text">Supporting Santa Cruz businesses keeps our community thriving, preserves local character, and strengthens the coastal economy we all depend on.</p>
                    </div>
                </div>
                <div id="search-results" class="business-grid"></div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="section-header">
                <div class="forecast-header">
                    <h2 class="forecast-title">Profile</h2>
                </div>
            </div>

            <div id="profile-loading" class="loading">Loading profile information</div>
            <div id="profile-error" class="error" style="display: none;"></div>
            <div id="profile-content" style="display: none;">
                <div class="profile-section">
                    <div class="profile-field">
                        <div class="profile-label">Business Name</div>
                        <div class="profile-value" id="profile-business-name">N/A</div>
                    </div>
                    <div class="profile-field">
                        <div class="profile-label">Email</div>
                        <div class="profile-value" id="profile-email">N/A</div>
                    </div>
                    <div class="profile-field">
                        <div class="profile-label">Address</div>
                        <div class="profile-value" id="profile-address">N/A</div>
                    </div>
                    <div class="profile-field">
                        <div class="profile-label">Business Type</div>
                        <div class="profile-value" id="profile-business-type">N/A</div>
                    </div>
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                        <button onclick="handleLogout()" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #ff6b6b; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 18px; height: 18px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                            </svg>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wave Pattern Footer -->
    <footer style="margin-top: 6rem; padding: 3rem 0; background: repeating-linear-gradient(45deg, rgba(10, 79, 110, 0.08) 0px, rgba(10, 79, 110, 0.08) 20px, rgba(232, 213, 183, 0.05) 20px, rgba(232, 213, 183, 0.05) 40px); border-top: 1px solid rgba(10, 79, 110, 0.2); position: relative; z-index: 1;">
        <div class="container" style="text-align: center; color: #0a4f6e; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;">
            <p style="margin: 0; font-size: 0.875rem;">Harbor - Supporting Santa Cruz's Coastal Economy</p>
        </div>
    </footer>

    <script>
        // Backend URL - change to localhost:8000 for local development
        const BACKEND_URL = 'https://harborproject-cruzhacks26.onrender.com';
        const LOCATION = 'Santa Cruz';

        // ===== Auth State Management =====
        function getAuthToken() {
            return localStorage.getItem('access_token') || localStorage.getItem('auth_token');
        }

        function setAuthToken(token) {
            localStorage.setItem('access_token', token);
            localStorage.setItem('auth_token', token); // Keep both for compatibility
        }

        function removeAuthToken() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('auth_token');
        }

        function isAuthenticated() {
            return !!getAuthToken();
        }

        function getAuthHeaders() {
            const token = getAuthToken();
            if (!token) return {};
            return {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };
        }

        // Initialize login form when DOM is ready
        function initLoginForm() {
            const loginForm = document.getElementById('login-form');
            if (loginForm && !loginForm.dataset.initialized) {
                // Mark as initialized to prevent duplicate listeners
                loginForm.dataset.initialized = 'true';
                
                // Add submit listener
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    console.log('Form submit event triggered');
                    handleLogin(e);
                });
                
                // Also add click listener to button as backup
                const loginBtn = loginForm.querySelector('button[type="submit"]');
                if (loginBtn) {
                    loginBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('Login button clicked');
                        handleLogin(e);
                    });
                }
                console.log('Login form initialized');
            }
        }

        // Check auth on page load
        function checkAuth() {
            if (isAuthenticated()) {
                document.getElementById('auth-container').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                // Show all tabs for authenticated users
                document.querySelectorAll('.tab-button[data-tab="touristpulse"]').forEach(btn => btn.style.display = '');
                document.querySelectorAll('.tab-button[data-tab="cashflow"]').forEach(btn => btn.style.display = '');
                document.querySelectorAll('.tab-button[data-tab="rentguard"]').forEach(btn => btn.style.display = '');
                document.querySelectorAll('.tab-button[data-tab="profile"]').forEach(btn => btn.style.display = '');
            } else {
                document.getElementById('auth-container').style.display = 'block';
                document.getElementById('main-app').style.display = 'block'; // Show main app but only Shopline tab
                // Hide protected tabs, show only Shopline
                document.querySelectorAll('.tab-button[data-tab="touristpulse"]').forEach(btn => btn.style.display = 'none');
                document.querySelectorAll('.tab-button[data-tab="cashflow"]').forEach(btn => btn.style.display = 'none');
                document.querySelectorAll('.tab-button[data-tab="rentguard"]').forEach(btn => btn.style.display = 'none');
                document.querySelectorAll('.tab-button[data-tab="profile"]').forEach(btn => btn.style.display = 'none');
                showTab('shopline');
            }
        }

        // Auth form switching
        function showAuthForm(formType) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            if (formType === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('signup-form').classList.add('active');
            }
            
            document.getElementById('auth-error').style.display = 'none';
            document.getElementById('auth-success').style.display = 'none';
        }

        // Handle login
        async function handleLogin(event) {
            if (event) {
                event.preventDefault();
            }
            console.log('handleLogin called');
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('auth-error');
            const successEl = document.getElementById('auth-success');

            if (!email || !password) {
                errorEl.textContent = 'Please enter both email and password';
                errorEl.style.display = 'block';
                return;
            }

            // Clear previous messages
            errorEl.style.display = 'none';
            successEl.style.display = 'none';

            try {
                const response = await fetch(`${BACKEND_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (!response.ok) {
                    let errorMessage = 'Login failed';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || error.message || `HTTP ${response.status}: ${response.statusText}`;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                if (!data.access_token) {
                    throw new Error('No access token received from server');
                }
                
                setAuthToken(data.access_token);
                successEl.textContent = 'Login successful!';
                successEl.style.display = 'block';
                errorEl.style.display = 'none';
                
                setTimeout(() => {
                    checkAuth();
                }, 500);
            } catch (err) {
                console.error('Login error:', err);
                // Handle network errors specifically
                if (err.name === 'TypeError' && err.message.includes('fetch')) {
                    errorEl.textContent = 'Network error: Could not connect to server. Please check your connection and try again.';
                } else if (err.message) {
                    errorEl.textContent = err.message;
                } else {
                    errorEl.textContent = 'Login failed. Please try again.';
                }
                errorEl.style.display = 'block';
                successEl.style.display = 'none';
            }
        }

        // Handle signup
        async function handleSignup(event) {
            event.preventDefault();
            const email = document.getElementById('signup-email').value;
            const businessName = document.getElementById('signup-business-name').value;
            const address = document.getElementById('signup-address').value;
            const businessType = document.getElementById('signup-business-type').value;
            const password = document.getElementById('signup-password').value;
            const errorEl = document.getElementById('auth-error');
            const successEl = document.getElementById('auth-success');

            try {
                const response = await fetch(`${BACKEND_URL}/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email,
                        business_name: businessName,
                        address,
                        business_type: businessType,
                        password
                    })
                });

                // Check if response is ok (status 200-299)
                if (response.ok) {
                    // Parse response to ensure it's valid JSON
                    try {
                        const data = await response.json();
                        console.log('Signup successful:', data);
                    } catch (e) {
                        // If response is empty or not JSON, that's still OK for 201 Created
                        console.log('Signup successful (no response body)');
                    }

                    successEl.textContent = 'Account created! Please login.';
                    successEl.style.display = 'block';
                    errorEl.style.display = 'none';
                    
                    // Switch to login form
                    setTimeout(() => {
                        showAuthForm('login');
                        document.getElementById('login-email').value = email;
                    }, 1000);
                } else {
                    // Handle error response
                    let errorMessage = 'Signup failed';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || error.message || `HTTP ${response.status}: ${response.statusText}`;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    throw new Error(errorMessage);
                }
            } catch (err) {
                console.error('Signup error:', err);
                // Check if it's a network error
                if (err.message === 'Failed to fetch' || err.name === 'TypeError') {
                    errorEl.textContent = 'Network error. The account may have been created. Please try logging in.';
                } else {
                    errorEl.textContent = err.message || 'Signup failed. Please try again.';
                }
                errorEl.style.display = 'block';
                successEl.style.display = 'none';
            }
        }

        // Handle logout
        function handleLogout() {
            removeAuthToken();
            checkAuth();
        }

        // Initialize auth check on page load
        checkAuth();
        
        // Initialize login form after a short delay to ensure DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initLoginForm, 100);
            });
        } else {
            setTimeout(initLoginForm, 100);
        }

        // ===== Tab Switching =====
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                // Check if user is trying to access protected tab
                if (!isAuthenticated() && ['touristpulse', 'cashflow', 'rentguard'].includes(tabName)) {
                    alert('Please login to access this feature');
                    return;
                }
                showTab(tabName);
            });
        });

        function showTab(tabName) {
            // Prevent access to protected tabs if not authenticated
            if (!isAuthenticated() && ['touristpulse', 'cashflow', 'rentguard', 'profile'].includes(tabName)) {
                return;
            }

            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            const tabElement = document.getElementById(tabName);
            const tabButton = document.querySelector(`[data-tab="${tabName}"]`);

            if (tabElement && tabButton) {
                tabElement.classList.add('active');
                tabButton.classList.add('active');
            }

            // Load data when switching to certain tabs
            if (tabName === 'rentguard') {
                loadAnalysesForRentGuard();
            } else if (tabName === 'cashflow') {
                loadPreviousAnalyses();
            } else if (tabName === 'shopline') {
                loadAllBusinesses();
            } else if (tabName === 'touristpulse') {
                loadTouristOutlook();
            } else if (tabName === 'profile') {
                loadProfile();
            }
        }

        // ===== Utility Functions =====
        function formatCurrency(amount) {
            if (amount === null || amount === undefined) return 'N/A';
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }

        function formatPercent(value) {
            if (value === null || value === undefined) return 'N/A';
            return `${(value * 100).toFixed(1)}%`;
        }

        function formatDate(dateString) {
            // Handle both date strings and date objects
            let date;
            if (typeof dateString === 'string') {
                // If it's just a date string (YYYY-MM-DD), parse it in local timezone
                // to avoid timezone conversion issues
                const [year, month, day] = dateString.split('-').map(Number);
                date = new Date(year, month - 1, day);
            } else {
                date = new Date(dateString);
            }
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateWithDay(dateString) {
            // Handle both date strings and date objects
            let date;
            if (typeof dateString === 'string') {
                const [year, month, day] = dateString.split('-').map(Number);
                date = new Date(year, month - 1, day);
            } else {
                date = new Date(dateString);
            }
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
            const dateStr = date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            return { dayName, dateStr };
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ===== Weather Icon Helper =====
        function getWeatherIcon(weatherText) {
            const text = weatherText.toLowerCase();
            // Check for cloudy/partly cloudy/fog conditions
            if (text.includes('cloud') || text.includes('fog') || text.includes('overcast') || text.includes('partly') || text.includes('patchy')) {
                // Sun with cloud (partly cloudy)
                return `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>`;
            } else {
                // Simple sun (sunny/clear)
                return `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <circle cx="12" cy="12" r="4" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
                </svg>`;
            }
        }

        // ===== Profile Functions =====
        async function loadProfile() {
            const loadingEl = document.getElementById('profile-loading');
            const errorEl = document.getElementById('profile-error');
            const contentEl = document.getElementById('profile-content');

            try {
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                contentEl.style.display = 'none';

                const response = await fetch(`${BACKEND_URL}/auth/me`, {
                    headers: getAuthHeaders()
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        // Token expired or invalid
                        removeAuthToken();
                        checkAuth();
                        throw new Error('Session expired. Please login again.');
                    }
                    let errorMessage = 'Failed to load profile';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || error.message || `HTTP ${response.status}: ${response.statusText}`;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                console.log('Profile data received:', data);
                
                // Update profile fields
                if (!data.business_name || !data.email) {
                    throw new Error('Invalid profile data received from server');
                }
                
                document.getElementById('profile-business-name').textContent = data.business_name || 'N/A';
                document.getElementById('profile-email').textContent = data.email || 'N/A';
                document.getElementById('profile-address').textContent = data.address || 'N/A';
                document.getElementById('profile-business-type').textContent = data.business_type || 'N/A';

                loadingEl.style.display = 'none';
                contentEl.style.display = 'block';
            } catch (err) {
                console.error('Profile loading error:', err);
                loadingEl.style.display = 'none';
                errorEl.textContent = err.message || 'Failed to load profile information';
                errorEl.style.display = 'block';
            }
        }

        // ===== TouristPulse Functions =====
        function getLevelLabel(level) {
            const labels = {
                'low': 'LOW',
                'moderate': 'NORMAL',
                'high': 'HIGH',
                'very_high': 'VERY HIGH'
            };
            return labels[level] || level.toUpperCase();
        }

        function getLevelClass(level) {
            return level === 'very_high' ? 'very_high' : level;
        }

        async function loadTouristOutlook() {
            const loadingEl = document.getElementById('tourist-loading');
            const errorEl = document.getElementById('tourist-error');
            const outlookEl = document.getElementById('tourist-outlook');
            const refreshBtn = document.getElementById('refresh-tourist-btn');

            try {
                refreshBtn.disabled = true;
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                outlookEl.style.display = 'none';

                const response = await fetch(
                    `${BACKEND_URL}/touristpulse/outlook?location=${encodeURIComponent(LOCATION)}&days=7`,
                    {
                        headers: getAuthHeaders()
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `API error: ${response.status}`);
                }

                const data = await response.json();

                if (!data.outlook || data.outlook.length === 0) {
                    throw new Error('No outlook data received');
                }

                displayTouristOutlook(data.outlook);

            } catch (err) {
                console.error('Error loading tourist outlook:', err);
                errorEl.innerHTML = `
                    <strong>Error:</strong> ${err.message}
                    <code>Make sure the backend is running at ${BACKEND_URL}</code>
                `;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
                refreshBtn.disabled = false;
            }
        }

        function displayTouristOutlook(outlook) {
            const outlookEl = document.getElementById('tourist-outlook');
            outlookEl.innerHTML = '';

            if (outlook.length === 0) {
                outlookEl.innerHTML = '<div class="empty-state">No outlook data available</div>';
                outlookEl.style.display = 'block';
                return;
            }

            outlook.forEach(day => {
                const card = document.createElement('div');
                const activityClass = day.demand_level === 'high' ? 'high' : 
                                     day.demand_level === 'moderate' ? 'moderate' : 
                                     'low';
                card.className = `outlook-card ${activityClass}`;

                // Extract key information from drivers
                let weatherText = '';
                let eventsText = '';
                let trafficText = '';
                
                if (day.drivers && Array.isArray(day.drivers)) {
                    day.drivers.forEach(driver => {
                        if (driver.source === 'weather' && driver.factor) {
                            // Capitalize first letter of each word
                            weatherText = driver.factor.split(' ').map(w => 
                                w.charAt(0).toUpperCase() + w.slice(1)
                            ).join(' ');
                        } else if (driver.source === 'events' && driver.factor) {
                            // Parse "6 event(s)" format or just use the text
                            const eventMatch = driver.factor.match(/(\d+)\s*event/i);
                            if (eventMatch) {
                                const count = parseInt(eventMatch[1]);
                                eventsText = count === 1 ? '1 event' : `${count} events`;
                            } else {
                                eventsText = driver.factor;
                            }
                        } else if (driver.source === 'traffic' && driver.factor) {
                            trafficText = driver.factor;
                        }
                    });
                }

                // If no drivers parsed, try to extract from summary
                if (!weatherText && day.summary) {
                    const weatherMatch = day.summary.match(/(sunny|cloudy|rainy|clear|mostly sunny|partly cloudy|overcast)/i);
                    if (weatherMatch) {
                        weatherText = weatherMatch[1].charAt(0).toUpperCase() + weatherMatch[1].slice(1);
                    }
                }

                // Extract traffic level from summary if not found
                if (!trafficText || trafficText === 'congestion') {
                    if (day.summary) {
                        const summaryLower = day.summary.toLowerCase();
                        if (summaryLower.includes('high congestion') || summaryLower.includes('heavy traffic')) {
                            trafficText = 'High congestion';
                        } else if (summaryLower.includes('moderate congestion') || summaryLower.includes('moderate traffic')) {
                            trafficText = 'Moderate congestion';
                        } else if (summaryLower.includes('low congestion') || summaryLower.includes('light traffic')) {
                            trafficText = 'Low congestion';
                        } else {
                            trafficText = 'Moderate congestion';
                        }
                    } else {
                        trafficText = 'Moderate congestion';
                    }
                } else {
                    // Capitalize traffic text
                    trafficText = trafficText.charAt(0).toUpperCase() + trafficText.slice(1);
                }

                // Format weather text
                if (!weatherText) weatherText = 'Weather data unavailable';

                // Get activity level label
                const activityLabel = day.demand_level === 'high' ? 'High Activity' : 
                                    day.demand_level === 'moderate' ? 'Moderate Activity' : 
                                    'Low Activity';
                // activityClass already defined above
                const confidencePercent = day.confidence ? Math.round(day.confidence * 100) : 0;
                const { dayName, dateStr } = formatDateWithDay(day.date);

                // Activity icon SVG
                const activityIcon = activityClass === 'high' 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>`
                    : activityClass === 'moderate'
                    ? `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>`;

                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-date-container">
                            <div class="card-day">${dayName}</div>
                            <div class="card-date">${dateStr}</div>
                        </div>
                        <div class="activity-badge ${activityClass}">
                            <div class="activity-icon">${activityIcon}</div>
                            ${activityLabel}
                        </div>
                    </div>
                    ${day.summary ? `<div class="card-summary">${day.summary}</div>` : ''}
                    <div class="key-drivers">
                        <div class="key-drivers-title">KEY DRIVERS</div>
                        ${weatherText ? `
                            <div class="driver-item">
                                <div class="driver-icon">
                                    ${getWeatherIcon(weatherText)}
                                </div>
                                <span>${weatherText}</span>
                            </div>
                        ` : ''}
                        ${eventsText ? `
                            <div class="driver-item">
                                <div class="driver-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                                    </svg>
                                </div>
                                <span>${eventsText}</span>
                            </div>
                        ` : ''}
                        ${trafficText ? `
                            <div class="driver-item">
                                <div class="driver-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 7.5h13.5m-13.5 0a3 3 0 00-3 3v9a3 3 0 003 3h13.5a3 3 0 003-3v-9a3 3 0 00-3-3M5.25 7.5V6a2.25 2.25 0 012.25-2.25h9A2.25 2.25 0 0118.75 6v1.5M8.25 15a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm9 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
                                    </svg>
                                </div>
                                <span>${trafficText}</span>
                            </div>
                        ` : ''}
                    </div>
                `;

                outlookEl.appendChild(card);
            });

            outlookEl.style.display = 'grid';
        }

        // ===== CashFlow Functions =====
        const csvFileInput = document.getElementById('csv-file');
        const fileLabel = document.getElementById('file-label');

        csvFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileLabel.innerHTML = `<span>${e.target.files[0].name}</span>`;
                fileLabel.classList.add('has-file');
            } else {
                fileLabel.innerHTML = '<span>Click or drag to upload CSV</span>';
                fileLabel.classList.remove('has-file');
            }
        });

        document.getElementById('cashflow-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await analyzeCashFlow();
        });

        async function analyzeCashFlow() {
            const emptyEl = document.getElementById('cashflow-empty');
            const loadingEl = document.getElementById('cashflow-loading');
            const errorEl = document.getElementById('cashflow-error');
            const resultsEl = document.getElementById('cashflow-results');
            const analyzeBtn = document.getElementById('analyze-btn');

            const csvFile = document.getElementById('csv-file').files[0];
            const rent = document.getElementById('monthly-rent').value;
            const payroll = document.getElementById('monthly-payroll').value || 0;
            const other = document.getElementById('other-costs').value || 0;
            const cashOnHand = document.getElementById('cash-on-hand').value;
            const variableCostRate = document.getElementById('variable-cost-rate').value || 0;
            const businessName = document.getElementById('business-name').value;

            if (!csvFile) {
                errorEl.innerHTML = '<strong>Error:</strong> Please select a CSV file';
                errorEl.style.display = 'block';
                return;
            }

            try {
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'Analyzing...';
                emptyEl.style.display = 'none';
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                resultsEl.style.display = 'none';

                const formData = new FormData();
                formData.append('csv_file', csvFile);
                formData.append('rent', rent);
                formData.append('payroll', payroll);
                formData.append('other', other);
                formData.append('variable_cost_rate', variableCostRate);
                if (cashOnHand) formData.append('cash_on_hand', cashOnHand);
                if (businessName) formData.append('business_name', businessName);

                // FormData: Don't set Content-Type, browser sets it with boundary
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const response = await fetch(`${BACKEND_URL}/cashflow/analyze`, {
                    method: 'POST',
                    headers: headers,
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `API error: ${response.status}`);
                }

                const data = await response.json();
                displayCashFlowResults(data);
                loadPreviousAnalyses();

            } catch (err) {
                console.error('Error analyzing cash flow:', err);
                errorEl.innerHTML = `<strong>Error:</strong> ${err.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze Cash Flow';
            }
        }

        function displayCashFlowResults(data) {
            const resultsEl = document.getElementById('cashflow-results');
            const metrics = data.metrics;
            const explanation = data.explanation;

            const runwayText = metrics.runway_days === null || metrics.runway_days > 365
                ? 'Indefinite'
                : `${Math.round(metrics.runway_days)} days`;

            resultsEl.innerHTML = `
                <div class="analysis-card">
                    <div class="analysis-card-header">
                        <h4>${data.business_name || 'Analysis'} #${data.analysis_id}</h4>
                        <span class="risk-badge ${metrics.risk_state}">${metrics.risk_state}</span>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-value">${formatCurrency(metrics.avg_daily_revenue)}</div>
                            <div class="metric-label">Avg Daily Revenue</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${runwayText}</div>
                            <div class="metric-label">Cash Runway</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value ${metrics.trend_7d >= 0 ? 'positive' : 'negative'}">${metrics.trend_7d.toFixed(1)}%</div>
                            <div class="metric-label">7-Day Trend</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${formatPercent(metrics.fixed_cost_burden)}</div>
                            <div class="metric-label">Fixed Cost Burden</div>
                        </div>
                    </div>

                    <div class="explanation-section">
                        <h5>Key Insights</h5>
                        <ul class="bullets-list">
                            ${explanation.bullets.map(b => `<li>${b}</li>`).join('')}
                        </ul>

                        ${explanation.actions && explanation.actions.length > 0 ? `
                            <h5 style="margin-top: 1rem;">Recommended Actions</h5>
                            <ul class="recommendations-list">
                                ${explanation.actions.map(a => `<li>${a}</li>`).join('')}
                            </ul>
                        ` : ''}

                        <p style="margin-top: 1rem; font-size: 0.85rem; color: #6b7280;">
                            <em>${explanation.confidence_note}</em>
                        </p>
                    </div>
                </div>
            `;
            resultsEl.style.display = 'block';
        }

        async function loadPreviousAnalyses() {
            const historySection = document.getElementById('cashflow-history');
            const analysesList = document.getElementById('analyses-list');

            try {
                const response = await fetch(`${BACKEND_URL}/cashflow/analyses?limit=5`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) return;

                const analyses = await response.json();

                if (analyses.length === 0) {
                    historySection.style.display = 'none';
                    return;
                }

                analysesList.innerHTML = analyses.map(a => {
                    const riskState = a.risk_state.toLowerCase();
                    const isCritical = riskState === 'critical';
                    const isCaution = riskState === 'caution';
                    const isHealthy = riskState === 'healthy';
                    
                    let cardClass = 'analysis-history-card';
                    let dotColor = '#3b82f6';
                    let statusIcon = '';
                    let statusBg = '#dbeafe';
                    let statusBorder = '#3b82f6';
                    let statusText = 'Healthy';
                    
                    if (isCritical) {
                        cardClass += ' critical-card';
                        dotColor = '#ef4444';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="status-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>';
                        statusBg = '#fee2e2';
                        statusBorder = '#ef4444';
                        statusText = 'Critical';
                    } else if (isCaution) {
                        cardClass += ' caution-card';
                        dotColor = '#f59e0b';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="status-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                        statusBg = '#fef3c7';
                        statusBorder = '#f59e0b';
                        statusText = 'Caution';
                    } else {
                        cardClass += ' healthy-card';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="status-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>';
                        statusBg = '#dbeafe';
                        statusBorder = '#3b82f6';
                        statusText = 'Healthy';
                    }
                    
                    return `
                        <div class="${cardClass}" onclick="loadAnalysisDetails(${a.id})">
                            <div class="analysis-history-content">
                                <div class="analysis-history-left">
                                    <div class="analysis-dot" style="background-color: ${dotColor}"></div>
                                    <div class="analysis-info">
                                        <div class="analysis-business-name">${a.business_name || 'Analysis'} #${a.id}</div>
                                        <div class="analysis-date">${formatDateTime(a.created_at)}</div>
                                    </div>
                                </div>
                                <div class="analysis-status-badge" style="background: ${statusBg}; border-color: ${statusBorder}; color: ${statusBorder};">
                                    ${statusIcon}
                                    <span>${statusText}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                historySection.style.display = 'block';
            } catch (err) {
                console.error('Error loading analyses:', err);
            }
        }

        async function loadAnalysisDetails(analysisId) {
            try {
                const response = await fetch(`${BACKEND_URL}/cashflow/analyses/${analysisId}`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) throw new Error('Failed to load analysis');

                const data = await response.json();

                // Convert to display format
                const displayData = {
                    analysis_id: data.analysis_id,
                    business_name: data.business_name,
                    metrics: data.metrics,
                    explanation: {
                        bullets: [
                            `Analysis based on ${data.data_days} days of data`,
                            `Fixed costs: Rent ${formatCurrency(data.fixed_costs?.rent)}, Payroll ${formatCurrency(data.fixed_costs?.payroll)}`,
                            data.fixed_costs?.cash_on_hand ? `Cash reserves: ${formatCurrency(data.fixed_costs.cash_on_hand)}` : 'No cash reserves recorded'
                        ],
                        actions: [],
                        confidence_note: `Confidence: ${(data.metrics.confidence * 100).toFixed(0)}%`
                    }
                };

                displayCashFlowResults(displayData);
            } catch (err) {
                console.error('Error loading analysis details:', err);
            }
        }

        // ===== RentGuard Functions =====
        async function loadAnalysesForRentGuard() {
            const warningEl = document.getElementById('rentguard-warning');
            const formEl = document.getElementById('rentguard-form');
            const selectEl = document.getElementById('analysis-select');

            try {
                const response = await fetch(`${BACKEND_URL}/cashflow/analyses?limit=20`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) throw new Error('Failed to load analyses');

                const analyses = await response.json();

                if (analyses.length === 0) {
                    warningEl.style.display = 'block';
                    formEl.style.display = 'none';
                    return;
                }

                warningEl.style.display = 'none';
                formEl.style.display = 'block';

                selectEl.innerHTML = analyses.map(a =>
                    `<option value="${a.id}">${a.business_name || 'Analysis'} #${a.id} (${a.risk_state})</option>`
                ).join('');

                // Load scenarios for first analysis
                loadScenarios(analyses[0].id);

            } catch (err) {
                console.error('Error loading analyses for RentGuard:', err);
                warningEl.innerHTML = `<strong>Error:</strong> ${err.message}`;
                warningEl.style.display = 'block';
                formEl.style.display = 'none';
            }
        }

        document.getElementById('analysis-select').addEventListener('change', (e) => {
            if (e.target.value) {
                loadScenarios(e.target.value);
            }
        });

        document.getElementById('rentguard-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await simulateRentImpact();
        });

        async function simulateRentImpact() {
            const emptyEl = document.getElementById('rentguard-empty');
            const loadingEl = document.getElementById('rentguard-loading');
            const errorEl = document.getElementById('rentguard-error');
            const resultsEl = document.getElementById('rentguard-results');
            const simulateBtn = document.getElementById('simulate-btn');

            const analysisId = document.getElementById('analysis-select').value;
            const increasePct = document.getElementById('increase-pct').value;
            const newRent = document.getElementById('new-rent').value;
            const effectiveDate = document.getElementById('effective-date').value;

            if (!increasePct && !newRent) {
                errorEl.innerHTML = '<strong>Error:</strong> Please enter either a percentage increase or a new rent amount';
                errorEl.style.display = 'block';
                return;
            }

            try {
                simulateBtn.disabled = true;
                simulateBtn.textContent = 'Simulating...';
                emptyEl.style.display = 'none';
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                resultsEl.style.display = 'none';

                const payload = {
                    analysis_id: parseInt(analysisId)
                };
                if (increasePct) payload.increase_pct = parseFloat(increasePct);
                if (newRent) payload.new_rent = parseFloat(newRent);
                if (effectiveDate) payload.effective_date = effectiveDate;

                const headers = { ...getAuthHeaders(), 'Content-Type': 'application/json' };
                const response = await fetch(`${BACKEND_URL}/rentguard/impact`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `API error: ${response.status}`);
                }

                const data = await response.json();
                displayRentImpactResults(data);
                loadScenarios(analysisId);

            } catch (err) {
                console.error('Error simulating rent impact:', err);
                errorEl.innerHTML = `<strong>Error:</strong> ${err.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
                simulateBtn.disabled = false;
                simulateBtn.textContent = 'Simulate Impact';
            }
        }

        function displayRentImpactResults(data) {
            const resultsEl = document.getElementById('rentguard-results');
            const metrics = data.metrics;
            const explanation = data.explanation;

            const deltaClass = metrics.delta_monthly > 0 ? 'negative' : 'positive';
            const runwayImpactText = metrics.runway_impact_days === null
                ? 'N/A'
                : (metrics.runway_impact_days > 0 ? '+' : '') + Math.round(metrics.runway_impact_days) + ' days';

            resultsEl.innerHTML = `
                <div class="impact-card">
                    <div class="impact-header">
                        <h4>Rent Impact Analysis</h4>
                    </div>
                    <div class="impact-body">
                        <div class="impact-metrics">
                            <div class="metric-item">
                                <div class="metric-value">${formatCurrency(metrics.current_rent)}</div>
                                <div class="metric-label">Current Rent</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${formatCurrency(metrics.new_rent)}</div>
                                <div class="metric-label">New Rent</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value ${deltaClass}">${metrics.delta_monthly > 0 ? '+' : ''}${formatCurrency(metrics.delta_monthly)}</div>
                                <div class="metric-label">Monthly Change</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value ${deltaClass}">${metrics.delta_pct > 0 ? '+' : ''}${metrics.delta_pct.toFixed(1)}%</div>
                                <div class="metric-label">Percentage Change</div>
                            </div>
                        </div>

                        <div class="risk-transition">
                            <span class="risk-badge ${metrics.current_risk_state}">${metrics.current_risk_state}</span>
                            <span class="risk-arrow"></span>
                            <span class="risk-badge ${metrics.new_risk_state}">${metrics.new_risk_state}</span>
                        </div>

                        <div class="impact-metrics">
                            <div class="metric-item">
                                <div class="metric-value ${metrics.runway_impact_days < 0 ? 'negative' : ''}">${runwayImpactText}</div>
                                <div class="metric-label">Runway Impact</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${metrics.new_fixed_cost_burden ? formatPercent(metrics.new_fixed_cost_burden) : 'N/A'}</div>
                                <div class="metric-label">New Cost Burden</div>
                            </div>
                        </div>

                        <div class="explanation-section">
                            <h5>Summary</h5>
                            <p>${explanation.summary}</p>

                            ${explanation.key_drivers && explanation.key_drivers.length > 0 ? `
                                <h5>Key Concerns</h5>
                                <ul class="concerns-list">
                                    ${explanation.key_drivers.map(d => `<li>${d}</li>`).join('')}
                                </ul>
                            ` : ''}

                            ${explanation.recommended_actions && explanation.recommended_actions.length > 0 ? `
                                <h5>Recommended Actions</h5>
                                <ul class="recommendations-list">
                                    ${explanation.recommended_actions.map(a => `<li>${a}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            resultsEl.style.display = 'block';
        }

        async function loadScenarios(analysisId) {
            const historySection = document.getElementById('scenarios-history');
            const scenariosList = document.getElementById('scenarios-list');

            try {
                const response = await fetch(`${BACKEND_URL}/rentguard/scenarios/${analysisId}`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) return;

                const scenarios = await response.json();

                if (scenarios.length === 0) {
                    historySection.style.display = 'none';
                    return;
                }

                scenariosList.innerHTML = scenarios.map(s => `
                    <div class="history-item">
                        <span>${s.increase_pct ? `+${s.increase_pct.toFixed(1)}%` : formatCurrency(s.new_rent)}</span>
                        <span>
                            <span class="risk-badge ${s.new_risk_state}">${s.new_risk_state}</span>
                            <span class="date">${formatDateTime(s.created_at)}</span>
                        </span>
                    </div>
                `).join('');

                historySection.style.display = 'block';
            } catch (err) {
                console.error('Error loading scenarios:', err);
            }
        }

        // ===== Shopline Functions =====
        let allBusinesses = []; // Cache all businesses for filtering

        // Filter businesses as user types
        document.getElementById('shopline-query').addEventListener('input', (e) => {
            filterBusinesses(e.target.value);
        });

        document.getElementById('shopline-query').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                filterBusinesses(e.target.value);
            }
        });

        function handleShoplineSearch() {
            const query = document.getElementById('shopline-query').value;
            filterBusinesses(query);
        }

        function filterBusinesses(query) {
            const searchTerm = query.toLowerCase().trim();

            if (!searchTerm) {
                // Show all businesses if no search term
                displayBusinesses(allBusinesses);
                return;
            }

            // Filter businesses client-side
            const filtered = allBusinesses.filter(b => {
                const name = (b.name || '').toLowerCase();
                const category = (b.category || '').toLowerCase();
                const location = (b.location || '').toLowerCase();
                const description = (b.description || '').toLowerCase();

                return name.includes(searchTerm) ||
                       category.includes(searchTerm) ||
                       location.includes(searchTerm) ||
                       description.includes(searchTerm);
            });

            displayBusinesses(filtered);
        }

        async function loadAllBusinesses() {
            const loadingEl = document.getElementById('shopline-loading');
            const errorEl = document.getElementById('shopline-error');
            const resultsSection = document.getElementById('shopline-results');

            // Check if already loaded
            if (allBusinesses.length > 0) {
                loadingEl.style.display = 'none';
                resultsSection.style.display = 'block';
                return;
            }

            try {
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                resultsSection.style.display = 'none';

                const response = await fetch(`${BACKEND_URL}/shopline/all`);

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `API error: ${response.status}`);
                }

                const data = await response.json();
                allBusinesses = data.results || [];
                displayBusinesses(allBusinesses);

            } catch (err) {
                console.error('Error loading businesses:', err);
                errorEl.innerHTML = `<strong>Error:</strong> ${err.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function displayBusinesses(businesses) {
            const resultsSection = document.getElementById('shopline-results');
            const resultsEl = document.getElementById('search-results');
            const countEl = document.getElementById('business-count');

            // Update count
            const total = allBusinesses.length;
            const showing = businesses.length;
            if (showing === total) {
                countEl.textContent = total;
                document.getElementById('hero-business-count').textContent = `${total}+`;
            } else {
                countEl.textContent = showing;
                document.getElementById('hero-business-count').textContent = `${showing}+`;
            }

            if (businesses.length === 0) {
                resultsEl.innerHTML = '<div class="empty-state" style="padding: 3rem; text-align: center; color: #0a4f6e; font-size: 1.25rem; font-weight: 600;">No businesses found matching your search.</div>';
            } else {
                resultsEl.innerHTML = businesses.map(b => `
                    <div class="business-card">
                        <span class="category">${b.category || 'BUSINESS'}</span>
                        <h4>${b.name}</h4>
                        <div class="location">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 14px; height: 14px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                            </svg>
                            ${b.location}
                        </div>
                        ${b.description ? `<div class="description">${b.description}</div>` : ''}
                    </div>
                `).join('');
            }

            resultsSection.style.display = 'block';
        }

        // ===== Initialize =====
        window.addEventListener('DOMContentLoaded', () => {
            // Load Shopline businesses on page load (default tab)
            loadAllBusinesses();
        });
    </script>
</body>
</html>
